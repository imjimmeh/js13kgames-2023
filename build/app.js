"use strict";(()=>{var s=class{constructor({name:t}){this.name=t}};var l=class extends s{constructor(e){super({name:"ControlledBy"});this.controlledBy=e}};var r=class extends s{constructor({x:e,y:n}){super({name:"Position"});this.x=e??0,this.y=n??0}};var h=class extends s{constructor({vector:e,speed:n}){super({name:"Movement"});this.vector=e??new r({x:0,y:0}),this.speed=n??new r({x:0,y:0})}};var y=class extends s{constructor({r:e,g:n,b:m,a:C}){super({name:"Colour"});this.toRgb=()=>`rgb(${this.r}, ${this.g}, ${this.b}, ${this.a})`;this.r=e,this.g=n,this.b=m,this.a=C,this.toRgb=this.toRgb.bind(this)}};var u=class extends s{constructor({width:e,height:n}){super({name:"Size"});this.width=e,this.height=n}};function*S(){yield new y({r:255,g:0,b:0,a:255}),yield new r({x:0,y:0}),yield new u({width:200,height:200})}var i=class{getAcceptedEntities(t){return P(t,this)}},P=function*(o,t){for(let e of o)t.accepts(e)&&(yield e)};var f=class extends i{constructor(){super();this.keyStates=new Map;this.init=this.init.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}accepts(e){let n=e.components.get("ControlledBy");return n?n.controlledBy=="Player"&&e.components.has("Movement"):!1}init(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}update({entities:e}){for(let d of this.keyStates)d[1]=="Pressed"&&this.keyStates.set(d[0],"Held");let n=this.keyStates.get("ArrowUp")??"Released",m=this.keyStates.get("ArrowDown")??"Released",C=(n!="Released"?1:0)+(m!="Released"?-1:0);for(let d of this.getAcceptedEntities(e)){let I=d.components.get("Movement");I.vector.y=C}}onKeyDown(e){this.keyStates.set(e.key,"Pressed")}onKeyUp(e){this.keyStates.set(e.key,"Released")}};var g=class extends i{accepts(t){return t.components.has("Position")&&t.components.has("Movement")}init(){}update({entities:t}){for(let e of this.getAcceptedEntities(t)){let n=e.components.get("Position"),m=e.components.get("Movement");n.x+=m.vector.x,n.y+=m.vector.y}}};var E=class{constructor(){let t=document.querySelector("canvas");if(!t)throw"Could not find canvas";this._canvas=t,this._context=this._canvas.getContext("2d")}get canvas(){return this._canvas}get context(){return this._context}init(){this._canvas.width=window.innerWidth,this._canvas.height=window.innerHeight}clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},a=new E;var R=o=>{let t=o.components.get("Size"),e=o.components.get("Position"),n=o.components.get("Colour");a.context.fillStyle=n.toRgb(),a.context.fillRect(e.x,e.y,t.width,t.height)},v=class extends i{accepts(t){return t.components.has("Size")&&t.components.has("Position")&&t.components.has("Colour")}init(){}update({entities:t}){a.clearCanvas();for(let e of this.getAcceptedEntities(t))R(e)}};var x=class{constructor(){this.systems=[];this.entities=[];this.update=this.update.bind(this)}init(){a.init();for(let t of this.entities)t.init();for(let t of this.systems)t.init();window.requestAnimationFrame(this.update)}update(){for(let t of this.systems)t.update({entities:this.entities,systems:this.systems});console.log("ran update"),window.requestAnimationFrame(this.update)}};var b=class{constructor(){this.components=new Map}add(t){this.components.set(t.name,t)}get(t){let e=this.components.get(t);if(e)return e}has(t){return this.components.has(t)}all(){return this.components.values()}};var w=class{constructor(){this.components=new b;this.name=""}init(){for(let t of this.components.all())console.log(t);console.log("initialised",this)}};var c=new w;c.name="Player";for(let o of S())c.components.add(o);c.components.add(new h({}));c.components.add(new l("Player"));var p=new x;p.entities.push(c);p.systems.push(new f);p.systems.push(new g);p.systems.push(new v);p.init();})();
//# sourceMappingURL=app.js.map
